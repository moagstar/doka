/* =======================================================================
   Darkroom Print — 4 exposures per A4 page (2×2), with paper header shown
   Load AFTER your normal CSS. Keep browser "Headers & footers: OFF"
   and "Margins: None" in the print dialog.
   ======================================================================= */

@page { 
  size: A4 landscape; 
  margin-top: 5mm; /* Add margin at the top to prevent frames from printing at the edge */
  margin-left: 0;
  margin-right: 0;
  margin-bottom: 0;
  background: black; /* Make the page background black to match the contact sheet */
}

@media print {
  /* Predictable sizing + keep colors */
  *, *::before, *::after { box-sizing: border-box !important; }
  * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

  /* ---------- Tunables (mm) ---------- */
  :root{
    --body-margin: 8mm;   /* reduced margin to fit more content */
    --header-h: 14mm;      /* height reserved for the paper selector bar */
    --gap: 4mm;            /* grid gap between cards (both directions) */
    --page-h: 210mm;       /* A4 landscape height */
    --page-w: 297mm;       /* A4 landscape width */
    --available: calc(var(--page-h) - (2 * var(--body-margin)) - var(--header-h));
    --card-fudge: 1.5mm;   /* safety so two rows always fit (raise if your printer clips) */

    /* Contact sheet specific variables */
    --contact-cols: 6;     /* number of columns in the contact sheet grid */
    --contact-gap: 2mm;    /* gap between frames (vertical spacing between rows) */
    --frame-border: 1mm;   /* border width around frames */
  }

  /* ---------- Paper header (visible) ---------- */
  .paper-selection{
    display: block !important;
    position: fixed !important;
    top: 0; left: 0; right: 0;
    height: var(--header-h) !important;
    margin: 0 !important; padding: 0 !important; border: 0 !important;
    text-align: center !important;
    background: transparent !important;
  }

  /* Push content below header + apply inner margins */
  body{
    margin: calc(var(--body-margin) + var(--header-h))
            var(--body-margin)
            var(--body-margin)
            var(--body-margin) !important;
    background: #fff !important;
  }

  /* Strip spacing/borders that steal print height */
  .container, main, #images-section, #exposures-section, #exposures-list{
    margin: 0 !important; padding: 0 !important; border: 0 !important;
  }

  /* Hide non-print UI */
  .controls-container,
  .toolbar,
  #histogram-container,
  #histogram-canvas,
  .images-container,
  .mask-tools,
  .exposure-controls,
  .placeholder-message,
  .exposure-buttons { display: none !important; }

  /* ---------- Grid: exactly 2×2 per page ---------- */
  #exposures-list{
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: var(--gap) !important;
    overflow: visible !important;
  }

  /* Each card = half the printable height (minus one row gap) */
  .exposure-item{
    display: flex !important;
    flex-direction: column !important;
    height: calc( (var(--available) - var(--gap)) / 2 - var(--card-fudge) ) !important;
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    overflow: hidden !important;
    background: #fff !important;
    border: 1px solid #000 !important;   /* thin print-safe border */
    border-radius: 0 !important;
  }

  /* Clean page break after each group of four cards */
  .exposure-item:nth-of-type(4n){
    break-after: page; page-break-after: always;
  }

  /* ---------- Inside each card ---------- */

  /* The content wrapper should stretch to fill the card */
  .exposure-content{
    display: flex !important;
    flex-direction: column !important;
    flex: 1 1 auto !important;
    min-height: 0 !important;
    gap: 0 !important;
  }

  /* The preview area eats ALL remaining space */
  .dodge-mask-preview-container{
    /* OVERRIDE screen rules (e.g., width: 90px) */
    width: 100% !important;
    flex: 1 1 auto !important;
    min-height: 0 !important;
    max-height: none !important;
    margin: 0 0 2mm 0 !important;
    display: block !important;
    aspect-ratio: auto !important;        /* ignore any screen aspect locks */
    align-items: initial !important;       /* neutralize flex-centering if present */
    justify-content: initial !important;
  }

  /* Make sure portrait/landscape helper classes don't constrain height */
  .dodge-mask-preview-container.photo-portrait,
  .dodge-mask-preview-container.photo-landscape{
    height: auto !important;
  }

  /* The actual image/canvas fills the preview box and hugs the top */
  .dodge-mask-preview-container canvas,
  .dodge-mask-preview,
  canvas.dodge-mask-preview,
  .negative-container img,
  .result-container img{
    display: block !important;
    width: 90% !important;
    height: 90% !important;
    max-width: none !important;
    max-height: none !important;
    object-fit: contain !important;
    object-position: top center !important;
    border: 0 !important;
  }

  /* Meta area (time/grade/etc) sizes itself naturally below the preview */
  .settings-column{
    flex: 0 0 auto !important;
    margin: 2mm 0 0 0 !important;
    min-height: 0 !important;
  }

  /* Ensure controls are print-legible */
  .exposure-time, .grade-display{
    font-weight: bold !important;
  }

  /* Neutralize any color theme for clean B/W except mask preview (canvas) */
  body, .exposure-item, .settings-column, .grade-display, .exposure-time {
    background: #fff !important; color: #000 !important;
  }
}

@media print {
  /* Hide the entire Images panel, not just its contents */
  #images-section {
    display: none !important;
  }

  /* Let the Exposures panel take the full page width */
  #exposures-section {
    max-width: none !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
  }

  /* Don’t keep the screen flex row layout */
  main {
    display: block !important;   /* collapse to a single column */
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Nuke dark-theme backgrounds so the page isn’t maroon */
  .darkroom-view,
  .darkroom-view .container,
  .darkroom-view .panel,
  .darkroom-body {
    background: #fff !important;
  }
}

/* ======================================================================= 
   Contact Sheet Print Styles - Optimized for A4 paper
   ======================================================================= */
@media print {
  /* Hide UI elements that shouldn't be printed */
  .folder-select-container,
  .folder-path,
  .select-folder-message,
  .edited-indicator,
  .dustbin-icon {
    display: none !important;
  }

  /* Basic page setup for contact sheet */
  body:has(.contact-view:not(.hidden)) {
    background: black !important;
    margin: var(--body-margin) !important;
    padding: 0 !important;
    overflow: visible !important;
    height: auto !important;
  }

  /* Contact sheet container */
  .contact-container {
    height: auto !important;
    overflow: visible !important;
    scroll-snap-type: none !important;
  }

  /* Contact sheet */
  .contact-sheet {
    min-height: 0 !important;
    height: auto !important;
    padding: 0 !important;
    margin: 0 !important;
    position: relative !important;
  }

  /* No title for the printed page */
  .contact-sheet::before {
    display: none !important;
  }

  /* Grid layout optimized for A4 */
  .sheet-grid {
    --cols: var(--contact-cols) !important;
    gap-y: var(--contact-gap) !important;
    width: calc(var(--page-w) - (2 * var(--body-margin))) !important;
    margin: 0 auto !important;
    grid-auto-flow: row !important;
  }

  /* Control page breaks - 30 images per page (5 rows of 6 columns) */
  .frame:nth-child(30n) {
    page-break-after: always !important;
    break-after: page !important;
  }

  /* Frame styling */
  .frame {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    border: none !important; /* Remove border to avoid interference with film rebate */
    box-shadow: none !important;
    background: black !important; /* Match the background color of the frame in normal view */
    aspect-ratio: 1.1 !important; /* Correct 35mm film frame aspect ratio (36mm × 24mm) */
    height: auto !important;
  }

  /* Show decorative frame background (film rebate) */
  .frame::after {
    display: block !important;
    background: center/100% 100% no-repeat url("frame-tile.png") !important;
    position: absolute !important;
    inset: 0 !important;
    z-index: 3 !important;
    pointer-events: none !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Window adjustments */
  .window {
    left: 2mm !important;
    right: 2mm !important;
    top: 2mm !important;
    bottom: 2mm !important;
  }

  /* Image styling */
  .hit {
    cursor: default !important;
  }

  .hit > img {
    filter: none !important; /* Remove grayscale filter for better print quality */
    object-fit: contain !important;
    padding: 0 !important;
  }

  /* Better handling of portrait images */
  .hit > img.portrait {
    width: 75% !important;
    height: auto !important;
    transform: translate(-50%, -50%) rotate(-90deg) !important;
  }

  /* Remove hover effects */
  .hit::after {
    display: none !important;
  }
}
